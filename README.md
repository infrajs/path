# Path - общая система адресации на файлы для сервера и клиента
Поддерживаются файловые системы с CP1251 и UTF-8. Поддержка SEF-url, ЧПУ.

# Принципы и порядок работы с адресом
0. Корнем проекта является папка содержащая файл - ```vender/autoload.php```
0. Адрес записывается относительно корня проекта и для браузера, и для сервера. 
0. Недопустимо хранение и обработка абсолютных путей и путей содержающих последовательности "../", "./", "//", "\"
0. Слэш в конце означает только папку. Отстутствие слэша в конце означает только файл.
0. Используется только прямой слэш - "/"
0. Строку адреса можно использовать в качестве уникального идентификатора для содержимого файла. 
0. Путь может содержать параметры после "?" в этом случае нужно отдельно выполнять ```explode('?', $src, 2)``` для использования стандартных php функций для работы с файловой системой.
0. Есть предопределённая **папка c данными** проекта, которая не попадает в репозиторий системы контроля версий, может содержать credentials и использоваться для хранения данных формируемых во врмя работы проекта. Доступна для записи php. По умолчанию адрес папки с данными ```data/```. Короткое обозначение - символ **"~"**
0. Есть предопределённая **папка с кэшем**. Эта папка может быть удалена полностью в любой момент. Папка не загружается в репозиторий. Доступна для записи. По умолчанию адрес папки с кэшем ```cache/```. Короткое обозначение - символ **"!"**
0. Есть предопределённые **папки cо скриптами**, в которых будет осуществляться поиск файла при наличии в начале адреса символа **"-"**. По умолчанию это ```vendor/infrajs/, vendor/components/, bower_components/, ./```.
0. Адрес записывается в наиболее короткой форме и содержит принятые сокращения "-", "~", "!". 
0. Функции не меняют форму адреса, используемые в нём символы или его части и если необходимо генерируют только свою часть адреса и следят только за её правильностью. 
0. Функции исходят из того, что форма получаемого адреса соответствует указанным принципам и не проверяют это.
14. Анализ формы строки адреса и её изменение может быть в момент получения адреса от пользователя или от системы незнакомой с указанными принципами.
0. Работа с файловой системой на запись не должна выполняться при наличии ключа ```Path::$conf['fs'] = false```. Зависимости работающие с системой учитывают этот ключ. Если зависимая библиотека не может работать без файловой системы, то генерируется обычное исключение... throw new \Exception('Я не могу работать без файловой системы');
0. Рабочая дирректория в файлах php, обрабатывающих вызвовы из браузера, настроена на корень проекта с помощью ```chdir()```. Скрипт не полагается на своё фактическое расположение и содержит проверку.
0. Перед использование адреса в стандартных php-функциях работающих с файловой системой необходимо пропускать адрес через ```$src=Path::theme($src)```. Функция проверяет наличие указанного файла или папки и возвращает путь без специальных сокращений. Использовать надо путь, который эта функция вернула. Path::theme выполняет роль стандартных is_file is_dir file_exists. Папка или файл определяется наличием слэша в конце адреса.
0. Для удаление специальных символов из адреса без обращения к файловой системе предназначена функция ```$src=Path::resolve($src)``` для спецсимвола "-" выполнить эту операцию невозможно, будет сгенерировано исключение.

# Проверка и установка рабочей директории
```php
if (!is_file('vendor/autoload.php')) {
	chdir('../../../'); //Согласно фактическому расположению файла
	require_once('vendor/autoload.php');
}
```
# Path конфиг
В ```Path::$conf``` указывается по каким папкам:

* искать скрипты - search (-),
* где будет папка данных - data (~), 
* где будет папка кэша - cache (!). 

По умолчанию Path::$conf:

```php
Path::$conf = array(
	/**
	 * Параметр sefurl указывается true если настроен modrewrite. 
	 * .htaccess
	 * RewriteEngine on
	 * RewriteCond %{REQUEST_FILENAME} !-f
	 * RewriteRule ^(.*)$ vendor/infrajs/path/index.php [L,QSA]
	 *	
	 * В режиме sefurl=false все параметры передаются после знака "?" "site.ru/?contacts". 
	 *
	 * В режиме sefurl=true
	 * Если первый get-параметр в адресе не содержит значения (нет знака равно ?name) 
	 * Система посчитает это данными для контроллера проекта опрдяющими страницу, а не ссылку на файл. 
	 * Запись ?name выполнена для sefurl=false а для sefurl=true сработает редирект на адрес /name
	 * Таким обзом переключение в sefurl = true сохраняет старые ссылки работоспособными.
	 * 
	 * В режиме sefurl=true знак "?" не нужен "site.ru/contacts"
	 **/
	'sefurl' => false,
	'data' => 'data/',
	'cache' => 'cache/',
	'fs' => true,
	'search' => array(
		'vendor/infrajs/',
		'vendor/components/',
		'bower_components/'
	),
	/**
	 * Одно расширение, может содержать файлы для  подмены другого расширения. 
	 * Записывается так "catalog"=>array("vendor/infrajs/cards/")
	 * Файлы в папке *catalog/ будудут заменены на файлы в vendor/infrajs/cards/catalog/ при наличии
	 **/
	'clutch' => array()
);
``` 
## sefurl=false по умолчанию vendor/infrajs/path/index.php
* ```site.ru/vendor/infrajs/path/?~mypic.jpg``` указывает на файл ```site.ru/data/mypic.jpg```
* ```site.ru/vendor/infrajs/path/?-path/test.jpg``` указывает на файл ```site.ru/vendor/infrajs/path/test.jpg```

## sefurl=false с index.php в корне проекта 
* ```site.ru/?~mypic.jpg``` указывает на файл ```site.ru/data/mypic.jpg```
* ```site.ru/?-path/test.jpg``` указывает на файл ```site.ru/vendor/infrajs/path/test.jpg```

## sefurl=true c modrewrite положение index.php не важно
* ```site.ru/~mypic.jpg``` - указывает на файл ```site.ru/data/mypic.jpg```
* ```site.ru/-path/test.jpg``` - указывает на файл ```site.ru/vendor/infrajs/path/test.jpg```

## Корень проекта не привязан к корню веб-сервера
**site.ru** может быть папкой в стандартной конфигурации apache или nginx 127.0.0.1/git/site.ru/...

```php
echo Path::theme('~mypic.jpg'); //если файл есть "data/mypic.jpg" иначе false
echo Path::resolve('~mypic.jpg'); //всегда "data/mypic.jpg"
```

Приведёный пример для настройки modrewrite должен быть скорректирован на свой обработчик по аналогии с ```index.php```. Path выполняет узкий набор функций по нахождению файлов и декларации правил работы с адресом. Дальше можно уточнить, как работать с подключаемыми php файлами [infrajs/infra](https://github.com/infrajs/infra) и определить, что делать с запросами для которых файла найдено не было [infrajs/controller](https://github.com/infrajs/controller).